import random
import string
from typing import Dict, Optional
from .models import GameState, Player, Team, SecretWords, GamePhase
from .game_state import DecryptoGame


class RoomManager:
    def __init__(self):
        self.rooms: Dict[str, DecryptoGame] = {}
        # Большой словарь слов (можно заменить своим)
        self.word_bank = [
            "пират", "кролик", "собака", "кошка", "волк", "лиса", "медведь", "заяц",
            "тигр", "лев", "слон", "жираф", "зебра", "бегемот", "носорог", "кенгуру",
            "обезьяна", "белка", "ёж", "мышь", "крыса", "хомяк", "попугай", "орёл",
            "сокол", "воробей", "голубь", "ворона", "сова", "филин",
            "космос", "море", "огонь", "солнце", "луна", "дерево", "цветок", "ветер",
            "дождь", "снег", "гора", "река", "озеро", "лес", "поле", "звезда",
            "облако", "радуга", "гроза", "молния", "град", "туман", "роса", "лёд",
            "вулкан", "пустыня", "болото", "скала", "песок", "земля",
            "кофе", "чай", "пицца", "суши", "хлеб", "сыр", "вино", "пиво",
            "молоко", "вода", "сок", "лимонад", "коктейль", "водка", "коньяк",
            "мясо", "рыба", "курица", "яйцо", "салат", "суп", "борщ", "каша",
            "макароны", "рис", "гречка", "овощи", "фрукты", "яблоко", "банан",
            "апельсин", "лимон", "клубника", "шоколад", "мороженое",
            "футбол", "баскетбол", "теннис", "шахматы", "хоккей", "волейбол",
            "бейсбол", "гольф", "бокс", "борьба", "плавание", "бег", "лыжи",
            "коньки", "скейт", "велосипед", "йога", "фитнес", "шашки", "нарды",
            "домино", "покер", "рулетка", "дартс", "боулинг",
            "музей", "книга", "музыка", "кино", "фото", "театр", "цирк", "балет",
            "опера", "картина", "скульптура", "поэзия", "роман", "сказка", "миф",
            "легенда", "песня", "танец", "оркестр", "гитара", "пианино", "скрипка",
            "барабан", "флейта", "аккордеон",
            "компьютер", "телефон", "часы", "очки", "зонт", "телевизор", "планшет",
            "ноутбук", "клавиатура", "мышь", "экран", "камера", "видео", "радио",
            "микрофон", "наушники", "зарядка", "батарейка", "лампочка", "фонарик",
            "зеркало", "расческа", "зубная щетка", "мыло", "шампунь", "полотенце",
            "ножницы", "клей", "бумага", "ручка", "карандаш", "линейка", "циркуль",
            "транспортир", "калькулятор",
            "поезд", "самолет", "метро", "такси", "велосипед", "мотоцикл", "лодка",
            "машина", "автобус", "трамвай", "троллейбус", "корабль", "пароход",
            "яхта", "катер", "вертолет", "ракета", "космолет", "поезд", "электричка",
            "грузовик", "трактор", "экскаватор", "пожарная машина", "скорая помощь",
            "врач", "учитель", "инженер", "строитель", "водитель", "пилот",
            "капитан", "повар", "официант", "продавец", "полицейский", "пожарный",
            "ученый", "программист", "дизайнер", "архитектор", "журналист",
            "фотограф", "актер", "режиссер", "художник", "писатель", "поэт",
            "музыкант", "певец",
            "стол", "стул", "кровать", "диван", "шкаф", "полка", "зеркало",
            "ковер", "лампа", "люстра", "занавески", "подушка", "одеяло",
            "посуда", "тарелка", "чашка", "стакан", "вилка", "ложка", "нож",
            "одежда", "рубашка", "брюки", "джинсы", "футболка", "свитер",
            "куртка", "пальто", "шапка", "шарф", "перчатки", "носки",
            "обувь", "ботинки", "кроссовки", "туфли", "сапоги", "ремень",
            "галстук", "шляпа",
            "время", "пространство", "энергия", "сила", "свет", "тьма",
            "звук", "тишина", "мысль", "идея", "мечта", "реальность",
            "иллюзия", "тайна", "секрет", "правда", "ложь", "добро",
            "зло", "любовь", "ненависть", "страх", "радость", "грусть",
            "счастье",
        ]

    def create_room(self) -> str:
        """Создает новую комнату с уникальным кодом"""
        while True:
            # Генерируем 6-значный код
            code = ''.join(random.choices(string.ascii_uppercase + string.digits, k=6))
            if code not in self.rooms:
                self.rooms[code] = DecryptoGame(code, self.word_bank.copy())
                return code

    def get_room(self, room_code: str) -> Optional[DecryptoGame]:
        """Получает комнату по коду"""
        return self.rooms.get(room_code.upper())

    def room_exists(self, room_code: str) -> bool:
        return room_code.upper() in self.rooms

    def cleanup_empty_rooms(self):
        """Удаляет пустые комнаты (можно вызывать периодически)"""
        empty_rooms = []
        for code, game in self.rooms.items():
            if not game.state.players:  # нет игроков
                empty_rooms.append(code)

        for code in empty_rooms:
            del self.rooms[code]